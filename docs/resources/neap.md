---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "itsi_neap Resource - itsi"
subcategory: ""
description: |-
  Manages an Notable Event Aggregation Policy object within ITSI.
---

# itsi_neap (Resource)

Manages an Notable Event Aggregation Policy object within ITSI.

## Example Usage

```terraform
resource "itsi_neap" "policy_example" {
  breaking_criteria {
    duration {
      limit = 86400
    }
  }
  description = "This is the development version of the policy that will group together notable events by their alert_group field."
  disabled    = true
  filter_criteria {
    clause {
      notable_event_field {
        field    = "alert_group"
        operator = "="
        value    = "*"
      }
      notable_event_field {
        field    = "tier"
        operator = "="
        value    = "1"
      }
    }
  }
  group_instruction = "%last_instruction%"
  group_severity    = "info"
  group_status      = "%last_status%"
  group_title       = "%alert_group%"
  rule {
    actions {
      item {
        notable_status_change = "closed"
      }
      item {
        notable_event_comment = "Episode status automatically changed to Closed due to NEAP action triggered when episode is broken."
      }
    }
    activation_criteria {
      breaking_criteria {
      }
      notable_event_count {
        limit    = 1
        operator = "=="
      }
    }
  }
  rule {
    actions {
      item {
        email {
          content_type = "html"
          message      = <<-EOT
                        Status $result.slack_footer_msg$

                        $result.email_msg$
                        EOT
          priority     = "normal"
          subject      = "$result.slack_header$"
          to = [
            "teammember_1@outlook.com",
            "teammember_2@outlook.com",
          ]
        }
      }
      item {
        bigpanda_stateful {
          api_token   = "override with your token"
          app_key     = "override with your app key"
          check       = "itsi-episode-status"
          description = "$result.bp_desc$"
          parameters = {
            alert_group      = "$result.alert_group$"
            primary_property = "alert_group"
          }
          status = "$result.bp_status$"
        }
      }
      item {
        slack_adv {
          channel     = "%slack_channel%"
          payload     = <<-EOT
                        {
                        	"blocks": [
                        		{
                        			"type": "section",
                        			"text": {
                        				"type": "mrkdwn",
                        				"text": "*Status*:  %slack_change_icon% *Actions*: %slack_actions_msg%"
                        			}
                        		}
                        	]
                        }
                        EOT
          webhook_url = "https://hooks.slack.com/services/your_webhook"
        }
      }
      item {
        itsi_event_action_link_url {
          url             = "https://your_ref_link.com"
          url_description = "some description"
        }
      }
      item {
        script {
          filename = "test.sh"
        }
      }
    }

    activation_criteria {
      clause {
        notable_event_field {
          field    = "email_custom_action"
          operator = "="
          value    = "1"
        }
        notable_event_field {
          field    = "level"
          operator = "="
          value    = "3"
        }
      }
    }
  }
  rule {
    actions {
      item {
        notable_severity_change = "low"
      }
      item {
        notable_event_comment = "Changed episode priority to Low"
      }
    }
    activation_criteria {
      clause {
        notable_event_field {
          field    = "alert_value"
          operator = ">="
          value    = "100"
        }
        notable_event_field {
          field    = "level"
          operator = ">="
          value    = "3"
        }
      }
    }
  }
  run_time_based_actions_once = false
  split_by_field = [
    "alert_group", "host"
  ]
  title = "Dev: Episodes by Alert Group"
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `breaking_criteria` (Block Set, Min: 1, Max: 1) BreakingCriteria represents the criteria which retires an active group. (see [below for nested schema](#nestedblock--breaking_criteria))
- `filter_criteria` (Block Set, Min: 1, Max: 1) FilterCriteria represents the criteria which is responsible for tagging an incoming notable event with an existing policy. (see [below for nested schema](#nestedblock--filter_criteria))
- `title` (String) The title of the notable event aggregation policy.

### Optional

- `description` (String) The description of the notable event aggregation policy. Defaults to ``.
- `disabled` (Boolean) Defaults to `true`.
- `entity_factor_enabled` (Boolean) Defaults to `true`.
- `group_assignee` (String) The default owner of each episode created by the notable event aggregation policy. (Episode Asignee) Defaults to `%owner%`.
- `group_custom_instruction` (String) The custom instruction of each episode created by the notable event aggregation policy. Defaults to ``.
- `group_dashboard` (String) Customize the Episode dashboard using a JSON-formatted dashboard definition. The first notable event's fields are available to use as tokens in the dashboard. Defaults to ``.
- `group_dashboard_context` (String) Dashboard Tokens Defaults to `first`.
- `group_description` (String) The default owner of each episode created by the notable event aggregation policy. (Episode Description) Defaults to `%description%`.
- `group_instruction` (String) The default instructions of each episode created by the notable event aggregation policy. Defaults to `%instruction%`.
- `group_severity` (String) The default severity of each episode created by the notable event aggregation policy. (Episode Severity) Defaults to `%severity%`.
- `group_status` (String) The default status of each episode created by the notable event aggregation policy.  (Episode Asignee) Defaults to `%owner%`.
- `group_title` (String) The default title of each episode created by the notable event aggregation policy. (Episode Title) Defaults to `%title%`.
- `priority` (Number) Defaults to `5`.
- `rule` (Block Set) (see [below for nested schema](#nestedblock--rule))
- `run_time_based_actions_once` (Boolean) if you create an action to add a comment after an episode has existed for 60 seconds, a comment will only be added once for the episode. There are 2 conditions that trigger time-based actions:
					- The episode existed for (duration)
					- The flow of events into the episode paused for (pause) Defaults to `true`.
- `service_topology_enabled` (Boolean) Defaults to `true`.
- `split_by_field` (Set of String) Field episode to split by

### Read-Only

- `id` (String) The ID of this resource.

<a id="nestedblock--breaking_criteria"></a>
### Nested Schema for `breaking_criteria`

Optional:

- `breaking_criteria` (Block Set, Max: 1) Corresponds to the statement: if the episode is broken. Note: applicable only for the Activation Criteria. (see [below for nested schema](#nestedblock--breaking_criteria--breaking_criteria))
- `clause` (Block Set) (see [below for nested schema](#nestedblock--breaking_criteria--clause))
- `duration` (Block Set, Max: 1) Corresponds to the statement: if this episode existed for %%duration%% seconds (see [below for nested schema](#nestedblock--breaking_criteria--duration))
- `notable_event_count` (Block Set) Corresponds to the statement: if the number of events in this episode is %%operator%% %%limit%%. (see [below for nested schema](#nestedblock--breaking_criteria--notable_event_count))
- `pause` (Block Set, Max: 1) Corresponds to the statement: if the flow of events into the episode paused for %%param.pause%% seconds. (see [below for nested schema](#nestedblock--breaking_criteria--pause))

Read-Only:

- `condition` (String) Computed depends of the criteria type. In case of activation_criteria condition equals AND, otherwise - OR.

<a id="nestedblock--breaking_criteria--breaking_criteria"></a>
### Nested Schema for `breaking_criteria.breaking_criteria`

Optional:

- `config` (String) Defaults to ``.


<a id="nestedblock--breaking_criteria--clause"></a>
### Nested Schema for `breaking_criteria.clause`

Required:

- `notable_event_field` (Block Set, Min: 1) (see [below for nested schema](#nestedblock--breaking_criteria--clause--notable_event_field))

Optional:

- `condition` (String) Defaults to `AND`.

<a id="nestedblock--breaking_criteria--clause--notable_event_field"></a>
### Nested Schema for `breaking_criteria.clause.notable_event_field`

Required:

- `field` (String)
- `operator` (String)

Optional:

- `value` (String) The field's value wildcard to match. Ex: *.



<a id="nestedblock--breaking_criteria--duration"></a>
### Nested Schema for `breaking_criteria.duration`

Required:

- `limit` (Number)


<a id="nestedblock--breaking_criteria--notable_event_count"></a>
### Nested Schema for `breaking_criteria.notable_event_count`

Required:

- `limit` (Number)
- `operator` (String)


<a id="nestedblock--breaking_criteria--pause"></a>
### Nested Schema for `breaking_criteria.pause`

Required:

- `limit` (Number)



<a id="nestedblock--filter_criteria"></a>
### Nested Schema for `filter_criteria`

Optional:

- `breaking_criteria` (Block Set, Max: 1) Corresponds to the statement: if the episode is broken. Note: applicable only for the Activation Criteria. (see [below for nested schema](#nestedblock--filter_criteria--breaking_criteria))
- `clause` (Block Set) (see [below for nested schema](#nestedblock--filter_criteria--clause))
- `duration` (Block Set, Max: 1) Corresponds to the statement: if this episode existed for %%duration%% seconds (see [below for nested schema](#nestedblock--filter_criteria--duration))
- `notable_event_count` (Block Set) Corresponds to the statement: if the number of events in this episode is %%operator%% %%limit%%. (see [below for nested schema](#nestedblock--filter_criteria--notable_event_count))
- `pause` (Block Set, Max: 1) Corresponds to the statement: if the flow of events into the episode paused for %%param.pause%% seconds. (see [below for nested schema](#nestedblock--filter_criteria--pause))

Read-Only:

- `condition` (String) Computed depends of the criteria type. In case of activation_criteria condition equals AND, otherwise - OR.

<a id="nestedblock--filter_criteria--breaking_criteria"></a>
### Nested Schema for `filter_criteria.breaking_criteria`

Optional:

- `config` (String) Defaults to ``.


<a id="nestedblock--filter_criteria--clause"></a>
### Nested Schema for `filter_criteria.clause`

Required:

- `notable_event_field` (Block Set, Min: 1) (see [below for nested schema](#nestedblock--filter_criteria--clause--notable_event_field))

Optional:

- `condition` (String) Defaults to `AND`.

<a id="nestedblock--filter_criteria--clause--notable_event_field"></a>
### Nested Schema for `filter_criteria.clause.notable_event_field`

Required:

- `field` (String)
- `operator` (String)

Optional:

- `value` (String) The field's value wildcard to match. Ex: *.



<a id="nestedblock--filter_criteria--duration"></a>
### Nested Schema for `filter_criteria.duration`

Required:

- `limit` (Number)


<a id="nestedblock--filter_criteria--notable_event_count"></a>
### Nested Schema for `filter_criteria.notable_event_count`

Required:

- `limit` (Number)
- `operator` (String)


<a id="nestedblock--filter_criteria--pause"></a>
### Nested Schema for `filter_criteria.pause`

Required:

- `limit` (Number)



<a id="nestedblock--rule"></a>
### Nested Schema for `rule`

Required:

- `actions` (Block Set, Min: 1) (see [below for nested schema](#nestedblock--rule--actions))
- `activation_criteria` (Block Set, Min: 1, Max: 1) ActivationCriteria represents the criteria satisfying which a Rule is activated for an incoming notable event or an existing group of notables. (see [below for nested schema](#nestedblock--rule--activation_criteria))

Optional:

- `description` (String) Defaults to ``.
- `priority` (Number) Defaults to `5`.
- `title` (String) Defaults to ``.

Read-Only:

- `_key` (String)

<a id="nestedblock--rule--actions"></a>
### Nested Schema for `rule.actions`

Required:

- `item` (Block Set, Min: 1) (see [below for nested schema](#nestedblock--rule--actions--item))

Optional:

- `condition` (String) Defaults to `AND`.

<a id="nestedblock--rule--actions--item"></a>
### Nested Schema for `rule.actions.item`

Optional:

- `bigpanda_stateful` (Block Set, Max: 1) Send a Stateful BigPanda Alert (see [below for nested schema](#nestedblock--rule--actions--item--bigpanda_stateful))
- `email` (Block Set, Max: 1) Send email (see [below for nested schema](#nestedblock--rule--actions--item--email))
- `execute_on` (String) ExecutionCriteria is essentially the criteria answering: "on which events is ActionItem applicable?". Defaults to `GROUP`.
- `itsi_event_action_link_url` (Block Set, Max: 1) Set options to associate an episode with an external URL.
			  Follow this stanza name with any number of the following
			  attribute/value pairs.
			  If you do not specify an entry for each attribute, Splunk will
			  use the default value. (see [below for nested schema](#nestedblock--rule--actions--item--itsi_event_action_link_url))
- `itsi_event_action_send_to_phantom` (Block Set, Max: 1) Run a script stored in $SPLUNK_HOME/bin/scripts. Note: DEPRECATED (see [below for nested schema](#nestedblock--rule--actions--item--itsi_event_action_send_to_phantom))
- `itsi_sample_event_action_ping` (Block Set, Max: 1) Given one or more ITSI episodes, ping the `host` in it. (see [below for nested schema](#nestedblock--rule--actions--item--itsi_sample_event_action_ping))
- `notable_event_comment` (String)
- `notable_owner_change` (String)
- `notable_severity_change` (String)
- `notable_status_change` (String)
- `pagerduty_v2` (Block Set, Max: 1) Send a Stateful PagerDuty Alert (see [below for nested schema](#nestedblock--rule--actions--item--pagerduty_v2))
- `script` (Block Set, Max: 1) Run a script stored in $SPLUNK_HOME/bin/scripts. Note: DEPRECATED (see [below for nested schema](#nestedblock--rule--actions--item--script))
- `slack_adv` (Block Set, Max: 1) Send an advanced message to a Slack channel (see [below for nested schema](#nestedblock--rule--actions--item--slack_adv))

<a id="nestedblock--rule--actions--item--bigpanda_stateful"></a>
### Nested Schema for `rule.actions.item.bigpanda_stateful`

Required:

- `api_token` (String)
- `app_key` (String) Override the integration for this alert by entering the App Key of another integration in BigPanda

Optional:

- `api_url` (String) Defaults to `https://api.bigpanda.io`.
- `check` (String) Secondary object or sub-item that caused the alert (often shown as an incident subtitle in BigPanda). Defaults to ``.
- `description` (String) Brief summary (max. 2048 characters) of the alert for certain monitoring tools. Ex: itsi-episode-status Defaults to ``.
- `host` (String) Main object that caused the alert. Can be the associated host or, if a host isn't relevant, 
							a service or an application. Ex: $result.bp_desc$ Defaults to ``.
- `parameters` (Map of String) Extra parameters.
- `status` (String) Ex: $result.bp_status$. Status of the alert. One of [ ok, critical, warning, acknowledged ]. Defaults to ``.


<a id="nestedblock--rule--actions--item--email"></a>
### Nested Schema for `rule.actions.item.email`

Required:

- `message` (String) The email message can include tokens that insert text based on the results of the search. e.g. Status $result.slack_footer_msg$ $result.email_msg$ Dashboard: $result.dashboard$ Runbook: $result.runbook$ View in Splunk ITSI: https://itsi_url/itsi_event_management
- `subject` (String) The email subject can include tokens that insert text based on the results of the search. e.g. $result.fieldname$
- `to` (Set of String)

Optional:

- `bcc` (Set of String)
- `cc` (Set of String)
- `content_type` (String)
- `priority` (String) Defaults to `critical`.


<a id="nestedblock--rule--actions--item--itsi_event_action_link_url"></a>
### Nested Schema for `rule.actions.item.itsi_event_action_link_url`

Required:

- `url` (String) The external link for drilldown purposes. The URL must start with with http:// or https://. Otherwise it is interpreted as a relative URI.

Optional:

- `kwargs` (String) A dictionary of additional fields to pass to the URL. Defaults to ``.
- `operation` (String) Specifies the type of action to take on the URL.
							If "upsert", ITSI inserts or updates existing fields.
							If "delete", ITSI deletes the URL. Defaults to `upsert`.
- `url_description` (String) A description of the link destination. For display purposes only. Defaults to ``.


<a id="nestedblock--rule--actions--item--itsi_event_action_send_to_phantom"></a>
### Nested Schema for `rule.actions.item.itsi_event_action_send_to_phantom`

Required:

- `ph_label` (String) Label which determines which playbooks to trigger.
- `ph_server` (String) The Phantom server to which to send the ITSI episode


<a id="nestedblock--rule--actions--item--itsi_sample_event_action_ping"></a>
### Nested Schema for `rule.actions.item.itsi_sample_event_action_ping`

Optional:

- `host_to_ping` (String) Type the event field that contains the host that you want to ping in the Host field. For example, %server%. Defaults to `%orig_host%`.


<a id="nestedblock--rule--actions--item--pagerduty_v2"></a>
### Nested Schema for `rule.actions.item.pagerduty_v2`

Required:

- `dedup_key` (String) Deduplication key for correlating events.
- `severity` (String) Severity of the described event; one of critical, error, warning, info, or ok (all clear)
- `source` (String) Unique location of the affected system, often a hostname or FQDN
- `summary` (String) Text summary of the event

Optional:

- `custom_details` (String) Additional details about the event and affected system. Must be valid JSON.
							Other standard Events v2 API parameters (timestamp, component, group, class, images, links)
							may be included in this JSON and will be properly sent. Defaults to ``.
- `integration_url` (String) Defaults to `https://events.pagerduty.com/v2/enqueue`.
- `pagerduty_service` (String) Technical Service in PagerDuty to which events should be routed Defaults to `unknown`.
- `routing_key` (String) Override the integration for this alert by entering the App Key of another integration in BigPanda
- `trigger_state` (String) The "trigger state" for this run of the alert check. This is used to implement stateful alerting.
							This parameter should contain a value that changes if and only if an update event should be sent to PagerDuty.
							If left empty, the value of the severity parameter will be used.
							Another common implementation is to compute the trigger condition (true or false) in SPL and place that value in a field that is specified here (eg. "$result.trigger$").
							If you wish to send updates to PagerDuty upon other changes as well (besides the threshold condition), you can concatenate the values of those additional fields here also. 
							For example, if you set this to "$result.threshold$,$result.severity$" then you can send updates to PagerDuty when the trigger threshold remains exceeded, but the severity increases (or decreases). Defaults to ``.

Read-Only:

- `default_routing_key` (String) Default Integration for this alert by entering the App Key of another integration in BigPanda


<a id="nestedblock--rule--actions--item--script"></a>
### Nested Schema for `rule.actions.item.script`

Required:

- `filename` (String)


<a id="nestedblock--rule--actions--item--slack_adv"></a>
### Nested Schema for `rule.actions.item.slack_adv`

Required:

- `channel` (String) Slack channel (or channels, separated by commas) to send the message to (should start with # or @); can include tokens for expansion, see below.
- `payload` (String) Enter the Slack message payload to send to the Slack channel(s). The payload can include tokens that will be expanded using the results of the search. The payload must follow the Slack message payload format: https://api.slack.com/reference/messaging/payload
- `webhook_url` (String) The webhook URL to send the Slack message requests to. This can be obtained by creating a new "Incoming webhook" integration in Slack.

Optional:

- `from_user` (String) The name of the user sending the Slack message. By default this is "Splunk". Defaults to `Splunk`.
- `from_user_icon` (String) URL to an icon to show as the avatar for the Slack message. By default this is a Splunk icon. Defaults to `https://s3-us-west-1.amazonaws.com/ziegfried-apps/slack-alerts/splunk-icon.png`.
- `webhook_url_override` (String) You can override the Slack webhook URL here if you need to send the alert message to a different Slack team. Defaults to ``.




<a id="nestedblock--rule--activation_criteria"></a>
### Nested Schema for `rule.activation_criteria`

Optional:

- `breaking_criteria` (Block Set, Max: 1) Corresponds to the statement: if the episode is broken. Note: applicable only for the Activation Criteria. (see [below for nested schema](#nestedblock--rule--activation_criteria--breaking_criteria))
- `clause` (Block Set) (see [below for nested schema](#nestedblock--rule--activation_criteria--clause))
- `duration` (Block Set, Max: 1) Corresponds to the statement: if this episode existed for %%duration%% seconds (see [below for nested schema](#nestedblock--rule--activation_criteria--duration))
- `notable_event_count` (Block Set) Corresponds to the statement: if the number of events in this episode is %%operator%% %%limit%%. (see [below for nested schema](#nestedblock--rule--activation_criteria--notable_event_count))
- `pause` (Block Set, Max: 1) Corresponds to the statement: if the flow of events into the episode paused for %%param.pause%% seconds. (see [below for nested schema](#nestedblock--rule--activation_criteria--pause))

Read-Only:

- `condition` (String) Computed depends of the criteria type. In case of activation_criteria condition equals AND, otherwise - OR.

<a id="nestedblock--rule--activation_criteria--breaking_criteria"></a>
### Nested Schema for `rule.activation_criteria.breaking_criteria`

Optional:

- `config` (String) Defaults to ``.


<a id="nestedblock--rule--activation_criteria--clause"></a>
### Nested Schema for `rule.activation_criteria.clause`

Required:

- `notable_event_field` (Block Set, Min: 1) (see [below for nested schema](#nestedblock--rule--activation_criteria--clause--notable_event_field))

Optional:

- `condition` (String) Defaults to `AND`.

<a id="nestedblock--rule--activation_criteria--clause--notable_event_field"></a>
### Nested Schema for `rule.activation_criteria.clause.notable_event_field`

Required:

- `field` (String)
- `operator` (String)

Optional:

- `value` (String) The field's value wildcard to match. Ex: *.



<a id="nestedblock--rule--activation_criteria--duration"></a>
### Nested Schema for `rule.activation_criteria.duration`

Required:

- `limit` (Number)


<a id="nestedblock--rule--activation_criteria--notable_event_count"></a>
### Nested Schema for `rule.activation_criteria.notable_event_count`

Required:

- `limit` (Number)
- `operator` (String)


<a id="nestedblock--rule--activation_criteria--pause"></a>
### Nested Schema for `rule.activation_criteria.pause`

Required:

- `limit` (Number)

## Import

Import is supported using the following syntax:

```shell
terraform import itsi_neap.example {{id}}
```
